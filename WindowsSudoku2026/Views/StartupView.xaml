<Window x:Class="WindowsSudoku2026.Views.StartupView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WindowsSudoku2026.Views"
        xmlns:controls="clr-namespace:WindowsSudoku2026.Controls" 
        xmlns:converters="clr-namespace:WindowsSudoku2026.Essential.SpecialConverters"
        xmlns:viewmodels="clr-namespace:WindowsSudoku2026.ViewModels" 
        xmlns:utils="clr-namespace:WindowsSudoku2026.Common.Utils;assembly=WindowsSudoku2026.Common"
        d:DataContext="{d:DesignInstance Type=viewmodels:StartupViewModel}"
        mc:Ignorable="d" 
        Title="StartupView" x:Name="MainWindow" MinHeight="920" MinWidth="520">
    <Grid x:Name="LayoutRoot">
        <Grid.Resources>
            <converters:ViewModelToVisibilityConverter x:Key="ViewModelToVisibilityConverter" />
        </Grid.Resources>
        <!-- TopBar -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- TopBar -->
            <RowDefinition Height="*"/>
            <!-- Content -->
        </Grid.RowDefinitions>

        <!-- TOP BAR -->
        <Border Grid.Row="0"
                Height="30"
                Background="Purple">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Button Content="Back" Height="30" Width="50" IsEnabled="{Binding NavigationService.CanGoBack}" Command="{Binding GoBackCommand}"/>
                <TextBlock Grid.Column="2" Margin="0 0 10 0" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="18" Visibility="{Binding NavigationService.CurrentViewModel, Converter={StaticResource ViewModelToVisibilityConverter}, UpdateSourceTrigger=PropertyChanged}" Text="{Binding GameService.Timer.ElapsedTime, StringFormat='\{0:mm\\:ss\}'}" Foreground="White" />
            </Grid>
        </Border>

        <ContentControl Focusable="False"
                        Grid.Row="1"
                        HorizontalAlignment="Stretch" 
                        VerticalAlignment="Stretch" Margin="0"
                        Content="{Binding NavigationService.CurrentViewModel, Mode=TwoWay}">
            <ContentControl.Resources>
                <DataTemplate DataType="{x:Type TypeName=viewmodels:MenuViewModel}">
                    <local:MenuView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type TypeName=viewmodels:PlayViewModel}">
                    <local:PlayView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type TypeName=viewmodels:CreateViewModel}">
                    <local:CreateView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type TypeName=viewmodels:PlayMenuViewModel}">
                    <local:PlayMenuView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type TypeName=viewmodels:PuzzleSelectionViewModel}">
                    <local:PuzzleSelectionView />
                </DataTemplate>
            </ContentControl.Resources>
        </ContentControl>
        
        <ContentControl Grid.Row="1" Panel.ZIndex="10" Content="{Binding NavigationService.CurrentSidePanelViewModel, Mode=TwoWay}">
            <ContentControl.Resources>
                <DataTemplate DataType="{x:Type TypeName=viewmodels:SettingsViewModel}">
                    <local:SettingsView x:Name="SettingsPanel"
                                        Background="White"
                                        BorderBrush="{DynamicResource BorderBrush}" 
                                        BorderThickness="1 0 0 0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Stretch" 
                                        Visibility="Visible"
                                        Width="500"  
                                        Focusable="False">
                        <local:SettingsView.Triggers>
                            <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                         From="0" To="1" Duration="0:0:0.2"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </local:SettingsView.Triggers>
                    </local:SettingsView>
                </DataTemplate>
                <DataTemplate DataType="{x:Type TypeName=viewmodels:SavePuzzleDialogViewModel}">
                    <local:SavePuzzleDialogView x:Name="SavePuzzleDialog"
                                                Background="White"
                                                BorderBrush="{DynamicResource BorderBrush}" 
                                                BorderThickness="1 0 0 0"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Stretch" 
                                                MinWidth="500"
                                                Visibility="Visible" 
                                                Focusable="False">
                        <local:SavePuzzleDialogView.Triggers>
                            <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                         From="0" To="1" Duration="0:0:0.2"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>                            
                        </local:SavePuzzleDialogView.Triggers>
                    </local:SavePuzzleDialogView>
                </DataTemplate>
            </ContentControl.Resources>

            <ContentControl.Style>
                <Style TargetType="ContentControl">
                    <Style.Triggers>
                        <!-- Wenn Content NICHT null ist -> Einblenden -->
                        <Trigger Property="HasContent" Value="True">
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.X)"
                                                 From="500" To="0" Duration="0:0:0.2"/>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 From="0" To="1" Duration="0:0:0.2"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </ContentControl.Style>

            <!-- Wichtig für die Animation: Transform initialisieren -->
            <ContentControl.RenderTransform>
                <TranslateTransform X="500"/>
            </ContentControl.RenderTransform>
        </ContentControl>

        <!-- Ebene 20: Benachrichtigungen (Mittig oben / Popups) -->
        <ContentControl Grid.Row="1" 
                        Panel.ZIndex="20" 
                        Content="{Binding NavigationService.CurrentNotificationViewModel}"
                        VerticalAlignment="Top" HorizontalAlignment="Center">
            <ContentControl.Resources>
                <DataTemplate DataType="{x:Type viewmodels:NotificationViewModel}">
                    <local:NotificationView />
                </DataTemplate>
            </ContentControl.Resources>
            <ContentControl.Style>
                <Style TargetType="ContentControl">
                    <Style.Triggers>
                        <Trigger Property="HasContent" Value="True">
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <!-- Von oben (Y=-100) reinrutschen lassen -->
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                     From="-100" To="0" Duration="0:0:0.3"/>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </ContentControl.Style>
            <ContentControl.RenderTransform>
                <TranslateTransform Y="-100"/>
            </ContentControl.RenderTransform>
        </ContentControl>
    </Grid>
</Window>
